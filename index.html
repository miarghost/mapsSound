<!DOCTYPE html>
<html>
<head>
    <title>Mapa con Ubicación</title>
</head>
<body>
    <button onclick="reproducirSonido()">Reproducir Sonido</button>
    <div id="map" style="width: 100%; height: 400px;"></div>
    <div id="error-message" style="color: red;"></div>

    <script>
        var marcadorUbicacion = null;
        var distanciaMaxima = 111.0; // Cambia esto según tus necesidades
        var map = null;
        var userLocation = null;

        // Función para reproducir un sonido
        function reproducirSonido() {
            var audio = new Audio('noitif.mp3');
            audio.play();
        }

        // Verificar la distancia entre la ubicación actual y la ubicación marcada
        function verificarDistancia() {
            if (!marcadorUbicacion || !userLocation) {
                return;
            }

            var origin = new google.maps.LatLng(marcadorUbicacion.getPosition().lat(), marcadorUbicacion.getPosition().lng());
            var destination = new google.maps.LatLng(userLocation.lat, userLocation.lng);

            // Initialize Distance Matrix service
            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix({
                origins: [origin],
                destinations: [destination],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
            }, function(response, status) {
                if (status === 'OK') {
                    var distance = response.rows[0].elements[0].distance.value / 1000; // Convert to kilometers
                    if (distance <= distanciaMaxima) {
                        reproducirSonido();
                    }
                }
            });
        }

        // Inicializar el mapa
        function initMap() {
            var mapOptions = {
                center: { lat: -34.6037, lng: -58.3816 }, // Coordenadas de Buenos Aires, Capital Federal
                zoom: 12
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);

            // Obtener y mostrar la ubicación del usuario
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // Crear un marcador para la ubicación del usuario
                    var userMarker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Tu ubicación'
                    });

                    // Crear un marcador inicial para la ubicación del usuario al cargar la página
                    marcadorUbicacion = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Ubicación seleccionada'
                    });

                    // Centrar el mapa en la ubicación del usuario
                    map.setCenter(userLocation);

                    // Iniciar la verificación de distancia
                    verificarDistancia();
                }, function(error) {
                    // Mostrar un mensaje de error si la geolocalización no está disponible o fue denegada
                    document.getElementById('error-message').textContent = 'No se pudo obtener la ubicación. ' + error.message;
                });
            } else {
                // Mostrar un mensaje de error si la geolocalización no es compatible con el navegador
                document.getElementById('error-message').textContent = 'La geolocalización no es compatible con este navegador.';
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCE1CQnb_tlNwl2HIUKVwbsKHjlly6zkD4&callback=initMap" async defer></script>

</body>
</html>
